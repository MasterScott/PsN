\input{inputs/format_header.tex}
\guidetitle{PVAR user guide}

\begin{document}

\maketitle


\section{Introduction}
Parameter variability

Examples
\begin{verbatim}
pvar scmlog1.txt -parameters=CL,V
pvar -models run1.mod run2.mod -parameters=CL,V
\end{verbatim}

\section{Input and options}

\subsection{Required input}
Required arguments are either an scm run directory or a list of model files and a list of parameters.

\begin{optionlist}

\optdefault{parameters}{CL,V,...}
A comma separated list of parameters.
\nextopt
\end{optionlist}

\subsection{Optional input}

\begin{optionlist}
\optdefault{samples}{n}
Number of simulated datasets to generate. Default is 100.
\nextopt
\optname{models}
If this option is present on the command line a list of model files can be passed as arguments instead of an scm logfile. For example \verb|pvar -models run1.mod run2.mod -parameters=CL,V|
\end{optionlist}

\section{Description}

Parametric variability can calculate how much of the variability of a parameter that is explained by the model. For every parameter listed on the command line PsN will calculate the total variance, the explained variance and the unexplained variance. The resulting table can be found in the result.csv

\section{Result}

The result.csv is formatted as follows:

The first row is the header explaining the columns.
The first column is the type of variability (EPV for explained, UPV for unexplained and PV for total). The second column is the number of the model starting with zero. They will come in the order of the scmlog or in the order specified on the command line when using the models option. The following columns are the variances for the parameters.

\begin{verbatim}
Type,Model,CL,V
EPV,0,1.64942442067797e-06,0.0620681720338984
UPV,0,7.1337349188431e-06,0.538948190857009
PV,0,8.78315933952107e-06,0.601016362890907
EPV,1,1.5230948760263e-05,0.0468773796610169
UPV,1,1.75795164007126e-06,0.387259333476643
PV,1,1.69889004003343e-05,0.43413671313766
\end{verbatim}

\section{Algorithm}

Simulate each model in one original version to get the total variability and one with all omegas set to zero to get the explained variability.

\begin{enumerate}
	\item Input: List of models.
	\item For each model:
	\begin{enumerate}
		\item Create two new models. One for EPV and one for PV
		\item If model has been run update the initial values from results.
		\item Remove \$EST
		\item If model already contain \$SIMULATION give a warning but keep \$SIMULATION
		\item Add \$SIMULATION (<seed>) NSUBS=<samples> ONLYSIM
		\item Add \$TABLE NOPRINT NOAPPEND FIRSTONLY ONEHEADER ID FILE=<EPV|PV><n>.tab <par1> <par2> ...
		\item Set \$OMEGA 0 FIX for the EPV model
	\end{enumerate}
	\item Run models
	\item Loop through table-files
\end{enumerate}

\end{document}
