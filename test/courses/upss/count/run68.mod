$PROB Repeated Time To Event (RTTE) + Ordered Categorical Data
$INPUT ID TIME ODV DOSE ICL IV IKA TYPE SMAX SMXH THR CAV CAVH CON
       CNT=DROP CNT2=DROP CNT3=DROP DV=HC HC2=DROP HC3=DROP FE EVID

$DATA data.csv IGNORE=@ ACCEPT=(THR.GT.0)

$PRED
  ;Baseline
 BASE=THETA(1)*EXP(ETA(1))
 C50=THETA(2)*EXP(ETA(2))
 ;Lambda
 LAMB=BASE*(1-CAVH/(CAVH+C50))

  ;Approximation of the factorial (log scale)
 LFAC=DV*LOG(DV)-DV+LOG(DV*(1+4*DV*(1+2*DV)))/6+LOG(3.1415)/2
 IF(DV.EQ.0) LFAC=0

  ;Logarithm of the Poisson distribution
 LPOI = -LAMB+DV*LOG(LAMB)-LFAC
  ;-2 Log Likelihood
 Y=-2*LPOI

$THETA
 (0,7)  ;BASE
 (0,6)        ; D50
$OMEGA BLOCK(2) 0.9 .01 .1    ;var covar var

$ESTIM MAXEVAL=9999 METHOD=COND LAPLACE -2LL PRINT=1 MSFO=msf68
$COV PRINT=E

$TABLE ID TIME NOPRINT ONEHEADER FILE=sdtab68
$TABLE ID CAV CAVH CON NOPRINT ONEHEADER FILE=cotab68
$TABLE ID DOSE NOPRINT ONEHEADER FILE=catab68
$TABLE ID ICL IV IKA NOPRINT ONEHEADER FILE=patab68
