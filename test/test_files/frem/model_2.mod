$PROBLEM    MOXONIDINE PK ANALYSIS
$INPUT      ID VISI XAT2=DROP DGRP DOSE FLAG=DROP ONO=DROP XIME=DROP
            DVO=DROP NEUY=DROP SCR=DROP AGE=DROP SEX NYHA=DROP WT
            COMP=DROP ACE=DROP DIG=DROP DIU=DROP NUMB=DROP TAD=DROP
            TIME VIDD=DROP CLCR=DROP AMT SS II VID CMT=DROP CONO=DROP
            DV EVID=DROP OVID=DROP MDV FREMTYPE
$DATA      frem_dataset.dta IGNORE=@
$ABBREVIATED DERIV2=NO COMRES=6
$SUBROUTINE ADVAN2 TRANS1
$PK
;;;FREM CODE BEGIN
     BSV_WT = ETA(4)
     BSV_SEX = ETA(5)
     TV_WT=THETA(6)
     TV_SEX=THETA(7)
;;;FREM CODE END

;----------IOV--------------------

   KPLAG = 0

   TVCL  = THETA(1)
   TVV   = THETA(2)
   TVKA  = THETA(3)

   CL    = TVCL*EXP(ETA(1))
   V     = TVV*EXP(ETA(2))
   KA    = TVKA*EXP(ETA(3))
   LAG   = THETA(4)
   PHI   = LOG(LAG/(1-LAG))
   ALAG1 = EXP(PHI+KPLAG)/(1+EXP(PHI+KPLAG))
   K     = CL/V
   S2    = V

$ERROR 

     IPRED = LOG(.025)
     W     = THETA(5)
     IF(F.GT.0) IPRED = LOG(F)
     IRES  = IPRED-DV
     IWRES = IRES/W
     Y     = IPRED+ERR(1)*W

;;;FREM CODE BEGIN
     Y_WT = TV_WT + BSV_WT
     Y_SEX = TV_SEX + BSV_SEX
     IF (FREMTYPE.EQ.100) THEN
        Y = Y_WT+EPS(2)
        IPRED = Y_WT
     END IF
     IF (FREMTYPE.EQ.200) THEN
        Y = Y_SEX+EPS(2)
        IPRED = Y_SEX
     END IF
;;;FREM CODE END
$THETA  (0,26.646) FIX
 (0,7.0892) FIX
 (0,0.242649) FIX
$THETA  (0,0.232801) FIX ; LAG
$THETA  (0,0.367108) FIX ; W
$THETA  77 ; TV_WT
 1 ; TV_SEX
$OMEGA  BLOCK(2) FIX
 0.0815324
 0.0635021 2.79894
$OMEGA  BLOCK(1) FIX
 0.0522103  ;         KA
$OMEGA  BLOCK(2)
 249.842  ;     BSV_WT
 -3.14661 0.163828  ;    BSV_SEX
$SIGMA  1  FIX
$SIGMA  1e-07  FIX  ;     EPSCOV
$ESTIMATION MAXEVALS=9990 PRINT=10 METHOD=CONDITIONAL
;$COV
$COVARIANCE PRINT=R UNCONDITIONAL

